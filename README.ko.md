# `@naverpay/pite`

`@naverpay/pite`ëŠ” **ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°œë°œì„ ìœ„í•œ Vite ë²ˆë“¤ëŸ¬ ì„¤ì • íŒ¨í‚¤ì§€**ì…ë‹ˆë‹¤.  
`Vite`ì™€ `Rollup`ì„ ê¸°ë°˜ìœ¼ë¡œ í•˜ì—¬ íš¨ìœ¨ì ì¸ ë²ˆë“¤ë§ì„ ì œê³µí•˜ë©°,  
**ESM(`.mjs`) ë° CJS(`.js`) ëª¨ë“ˆ í¬ë§·ì„ ì§€ì›**í•˜ê³ ,  
**ì™¸ë¶€ ì˜ì¡´ì„± ìë™ ê°ì§€ ë° í´ë¦¬í•„ ê´€ë¦¬ ê¸°ëŠ¥**ì„ ì œê³µí•©ë‹ˆë‹¤.

## ğŸš€ ì£¼ìš” ê¸°ëŠ¥

- ğŸ“¦ **ë‹¤ì¤‘ ëª¨ë“ˆ í¬ë§· ì§€ì›**: `ESM`(`.mjs`), `CJS`(`.js`) ì¶œë ¥ ì§€ì›
- âš¡ **ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°œë°œ ìµœì í™”**: `Vite`ì™€ `Rollup`ì„ í™œìš©í•œ ë²ˆë“¤ë§
- ğŸ¯ **íƒ€ê²Ÿ ë¸Œë¼ìš°ì € ì„¤ì • ê°€ëŠ¥**: `browserslist`ë¥¼ ì‚¬ìš©í•œ ES ë¹Œë“œ íƒ€ê²Ÿ ì§€ì •
- ğŸ”„ **ìë™ í´ë¦¬í•„ ì£¼ì…**: `core-js-pure` ê¸°ë°˜ì˜ í´ë¦¬í•„ì„ ìë™ìœ¼ë¡œ ì‚½ì…
- ğŸ”§ **ìœ ì—°í•œ ì„¤ì • ì§€ì›**: ë¹Œë“œ ì˜µì…˜ ë° ì™¸ë¶€ ì˜ì¡´ì„±ì„ ì‰½ê²Œ ì„¤ì • ê°€ëŠ¥
- ğŸ— **ëª¨ë“ˆ êµ¬ì¡° ìœ ì§€**: `preserveModules` ê¸°ëŠ¥ì„ ìœ ì§€í•˜ì—¬ íŠ¸ë¦¬ ì…°ì´í‚¹(Tree Shaking) ìµœì í™”
- ğŸ” **ë¹Œë“œ ê²€ì¦**: ë¹Œë“œ ì „/í›„ `publint` í†µí•´ ì„¤ì • ë° ê²°ê³¼ë¬¼ ê²€ì‚¬

## ğŸ“¥ ì„¤ì¹˜

ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ ê°œë°œ ì˜ì¡´ì„±ìœ¼ë¡œ ì„¤ì¹˜í•˜ì„¸ìš”.

```sh
npm install --save-dev @naverpay/pite
```

ë˜ëŠ” `pnpm`ì„ ì‚¬ìš©í•  ê²½ìš°:

```sh
pnpm add -D @naverpay/pite
```

## ğŸ“Œ ì‚¬ìš©ë²•

### 1ï¸âƒ£ Vite ì„¤ì • íŒŒì¼ ìƒì„±

`vite.config.ts` íŒŒì¼ì—ì„œ `createViteConfig`ë¥¼ ë¶ˆëŸ¬ì™€ ì„¤ì •í•©ë‹ˆë‹¤.

```ts
import { createViteConfig } from '@naverpay/pite'

export default createViteConfig({
    cwd: process.cwd(), // í˜„ì¬ ì‘ì—… ë””ë ‰í† ë¦¬
    entry: ['src/index.ts'], // ì—”íŠ¸ë¦¬ íŒŒì¼
    outputs: [
        { format: 'es', dist: 'dist/es' }, // ES ëª¨ë“ˆ ì¶œë ¥ ê²½ë¡œ
        { format: 'cjs', dist: 'dist/cjs' }, // CJS ëª¨ë“ˆ ì¶œë ¥ ê²½ë¡œ
    ],
    cssFileName: 'style.css', // CSS íŒŒì¼ ì¶œë ¥ ì´ë¦„
    allowedPolyfills: ['fetch', 'Promise'], // í—ˆìš©í•  í´ë¦¬í•„ ëª©ë¡
    ignoredPolyfills: ['Symbol'], // ì œì™¸í•  í´ë¦¬í•„ ëª©ë¡
    options: {
        minify: true, // ì½”ë“œ ì••ì¶• ì—¬ë¶€
        sourcemap: true, // ì†ŒìŠ¤ë§µ ìƒì„± ì—¬ë¶€
    },
})
```

### 2ï¸âƒ£ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¹Œë“œ ì‹¤í–‰

ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë²ˆë“¤ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```sh
vite build
```

ë¹Œë“œê°€ ì™„ë£Œë˜ë©´, `dist/es`, `dist/cjs` ë””ë ‰í† ë¦¬ì— ë²ˆë“¤ëœ íŒŒì¼ì´ ìƒì„±ë©ë‹ˆë‹¤.

---

## âš™ï¸ ì„¤ì • ì˜µì…˜

| ì˜µì…˜ëª…             | íƒ€ì…                                      | ì„¤ëª…                                                                                                            |
| ------------------ | ----------------------------------------- | --------------------------------------------------------------------------------------------------------------- |
| `cwd`              | `string`                                  | í˜„ì¬ ì‘ì—… ë””ë ‰í† ë¦¬ (ê¸°ë³¸ê°’: `'.'`)                                                                              |
| `entry`            | `string[]`                                | ì—”íŠ¸ë¦¬ íŒŒì¼ ê²½ë¡œ (glob íŒ¨í„´ í—ˆìš©)                                                                               |
| `outputs`          | `{format: 'es' \| 'cjs'; dist: string}[]` | ì¶œë ¥í•  ëª¨ë“ˆ í¬ë§· ë° ë””ë ‰í† ë¦¬ ì§€ì •                                                                               |
| `cssFileName`      | `string`                                  | ì¶œë ¥ë  CSS íŒŒì¼ ì´ë¦„                                                                                            |
| `allowedPolyfills` | `string[]`                                | í—ˆìš©í•  í´ë¦¬í•„ ëª©ë¡<br/>(í´ë¦¬í•„ì„ runtimeìœ¼ë¡œ í¬í•¨í•˜ì—¬ ë¹Œë“œ)                                                     |
| `ignoredPolyfills` | `string[]`                                | ì œì™¸í•  í´ë¦¬í•„ ëª©ë¡<br/>(ì˜¤ë¥˜ë¥¼ ë¬´ì‹œí•˜ê³  í´ë¦¬í•„ ì—†ì´ ë¹Œë“œ, ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ìµœì‹  ìŠ¤í™ì„ ë¬´ì‹œí•˜ëŠ”ë° ì‚¬ìš©) |
| `options`          | `BuildOptions`                            | ì¶”ê°€ì ì¸ Vite ë¹Œë“œ ì˜µì…˜                                                                                         |

---

## ğŸ‰ Why use pite?

### vite/tsupì˜ í•œê³„

- viteë¡œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë²ˆë“¤ë§í•œ ê²½í—˜ì´ ì—†ë‹¤ë©´ ì„¤ì •ì´ ì–´ë ¤ì›€
- ì—¬ëŸ¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ìš´ì˜í•  ê²½ìš° ë™ì¼í•œ ë²ˆë“¤ë§ ì„¤ì •ì´ ë°˜ë³µë¨
- `browserslist` ê¸°ë°˜ìœ¼ë¡œ í´ë¦¬í•„ì´ í•„ìš”í•œì§€ íŒë‹¨í•˜ëŠ” ê¸°ëŠ¥ì´ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µë˜ì§€ ì•Šì•„ì„œ, í´ë¦¬í•„ ì²˜ë¦¬ê°€ ê¹Œë‹¤ë¡­ê³  ì‚¬ì „ ì§€ì‹ í•„ìš”
- viteì™€ [tsup](https://github.com/egoist/tsup)ì„ í•¨ê»˜ ì‚¬ìš©í•  ê²½ìš° ë³„ë„ì˜ ì„¤ì • í•„ìš”
- tsup ë‹¨ë…ìœ¼ë¡œ ë¹Œë“œí•  ê²½ìš°, tsupì´ esbuild ê¸°ë°˜ì´ê¸° ë•Œë¬¸ì— í’ë¶€í•œ ìƒíƒœê³„ë¥¼ ê°€ì§„ rollup-plugin ì‚¬ìš© ë¶ˆê°€ëŠ¥

> piteë¥¼ í†µí•´ ì •í˜•í™”ëœ vite config preset ì œê³µ

### Dual package build ì§€ì›

- ESM ë° CJS í˜•ì‹ì„ ëª¨ë‘ ì§€ì›
- glob íŒ¨í„´ì„ ì‚¬ìš©í•´ subpath ì§€ì • ê°€ëŠ¥
- ëª¨ë“ˆ ì‹œìŠ¤í…œë³„ output path ì§€ì • ê°€ëŠ¥

### `browserslist` ê¸°ë°˜ íŠ¸ëœìŠ¤íŒŒì¼ë§

- ì‚¬ìš©ì²˜ì— `.browserslistrc`ê°€ ìˆë‹¤ë©´ ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ íŠ¸ëœìŠ¤íŒŒì¼
- ë³„ë„ ì„¤ì •ì´ ì—†ë‹¤ë©´ [ë„¤ì´ë²„í˜ì´ì—ì„œ ì‚¬ìš©ì¤‘ì¸ ì¿¼ë¦¬ (@naverpay/browserslist-config)](https://github.com/NaverPayDev/browserslist-config#readme)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ íŠ¸ëœìŠ¤íŒŒì¼

### í´ë¦¬í•„ ìë™ íŒë‹¨ ë° ìµœì í™”

- `browserslist`ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í´ë¦¬í•„ì´ í•„ìš”í•œ ì½”ë“œê°€ í¬í•¨ëœ ê²½ìš° ì´ë¥¼ ê°ì§€í•˜ì—¬ ì•ˆë‚´
- í´ë¦¬í•„ì´ í•„ìš”í•œ ê²½ìš°, [runtime](https://github.com/rollup/plugins/tree/master/packages/babel#babelhelpers) ë°©ì‹ìœ¼ë¡œ ì ìš©í•˜ì—¬ íŒ¨í‚¤ì§€ ìµœì í™”
- ì „ì—­ ì˜¤ì—¼ìœ¼ë¡œë¶€í„° ì•ˆì „í•œ core-js-pure ì§€ì›

### ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¹Œë“œ Best Practice ì œì‹œ

- entry path ê²€ì‚¬ ê¸°ëŠ¥ì„ ì œê³µí•˜ì—¬ ìµœì ì˜ ë””ë ‰í† ë¦¬ êµ¬ì¡° ì œì‹œ
- preserveModules, preserveDirectives ì§€ì›
- `package.json`ì—ì„œ ìë™ìœ¼ë¡œ ì™¸ë¶€ ì˜ì¡´ì„±ì„ ê°ì§€í•˜ì—¬ ë²ˆë“¤ì—ì„œ ì œì™¸
  - `dependencies`, `peerDependencies` ë“± ê¸°ë³¸ìœ¼ë¡œ ì œì™¸ ì²˜ë¦¬

### `publint`ë¥¼ ì´ìš©í•œ ë¹Œë“œ ê²€ì¦

- ë¹Œë“œ ì „ `package.json` êµ¬ì¡° ê²€ì¦
- ë¹Œë“œ í›„ ê²°ê³¼ë¬¼ì˜ ì •í•©ì„± ê²€ì‚¬

### ìì²´ `vite-tsup-plugin`

- ì‚¬ìš©ì²˜ì—ì„œ ë³„ë„ì˜ tsup ì„¤ì • ì—†ì´ ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥
- ì„ ì–¸ íŒŒì¼(`.d.ts`)ì„ ëª¨ë“ˆ ì‹œìŠ¤í…œë³„(ESM, CJS)ë¡œ ë¹Œë“œ
- [`vite-plugin-dts` module resolution ì´ìŠˆ í•´ì†Œ](https://github.com/NaverPayDev/pite/issues/27)
- tsupë§Œ ì‚¬ìš©í–ˆì„ ë•Œì™€ ë‹¬ë¦¬ ë²ˆë“¤ë§ì„ rollupìœ¼ë¡œ í•˜ê¸° ë•Œë¬¸ì— rollup-plugin ì‚¬ìš© ê°€ëŠ¥

## ğŸ¤– How pite works

### íŠ¸ëœìŠ¤íŒŒì¼/í´ë¦¬í•„ ì²˜ë¦¬

- [browserslist-to-esbuild](https://github.com/marcofugaro/browserslist-to-esbuild#readme)ë¥¼ ì‚¬ìš©í•˜ì—¬ browserslist ì½ì€ í›„ esbuildê°€ ì´í•´í•  ìˆ˜ ìˆë„ë¡ targetsìœ¼ë¡œ ë³€í™˜
- browserslist ê¸°ì¤€ìœ¼ë¡œ íŠ¸ëœìŠ¤íŒŒì¼ë§ / í´ë¦¬í•„ ê²€ì‚¬
- í´ë¦¬í•„ì´ í•„ìš”í•œ ê²½ìš° [core-js-pure (3.39.0)](https://github.com/babel/babel-polyfills/tree/main/packages/babel-plugin-polyfill-corejs3)ë¥¼ runtimeìœ¼ë¡œ [@rollup/plugin-babel](https://github.com/rollup/plugins), [@babel/plugin-transform-runtime](https://babeljs.io/docs/babel-plugin-transform-runtime) ì‚¬ìš©í•˜ì—¬ ì£¼ì…

### TypeScript íŒŒì¼ ì²˜ë¦¬

ìì²´ `vite-tsup-plugin`ë¥¼ í†µí•´ tsup ì‹¤í–‰ì½”ë“œë¥¼ í”ŒëŸ¬ê·¸ì¸í™”í•˜ì—¬ ì„ ì–¸ íŒŒì¼ ìƒì„±

### ë¹Œë“œ ê²°ê³¼ë¬¼ ê²€ì‚¬

ìì²´ `rollup-plugin-publint`ë¥¼ í†µí•´ ë¹Œë“œ ì „ `package.json` êµ¬ì¡° ê²€ì‚¬, ë¹Œë“œ í›„ ë¹Œë“œ ê²°ê³¼ë¬¼ ê²€ì‚¬

## ğŸ“œ ë¼ì´ì„ ìŠ¤

MIT License Â© 2025 NaverPay
